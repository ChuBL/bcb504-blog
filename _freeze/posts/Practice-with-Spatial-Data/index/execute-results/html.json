{
  "hash": "44caa251d8b8d406c03a94e5b29660b5",
  "result": {
    "markdown": "---\ntitle: \"Practice with Spatial Data\"\nauthor: \"Jiyin Zhang\"\nsubtitle: \"Malaria calamari\"\ndate: \"2023-04-11\"\ncategories: [DataViz, Malaria]\nimage: ZEfwRzQQxXzdm2C4qrNy--1--yk7o3.jpeg\ncode-fold: true\ncode-tools: true\ndescription: \"Malaria data maps\"\nformat: html\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──\n✔ ggplot2 3.3.6      ✔ purrr   1.0.1 \n✔ tibble  3.1.7      ✔ dplyr   1.0.10\n✔ tidyr   1.2.0      ✔ stringr 1.4.0 \n✔ readr   2.1.2      ✔ forcats 0.5.1 \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(readxl)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'rnaturalearthdata'\n\nThe following object is masked from 'package:rnaturalearth':\n\n    countries110\n```\n:::\n\n```{.r .cell-code}\nlibrary(dplyr)\n\nMalaria <- read.csv(\"National_Unit_data.csv\")\n\nIncidence<- Malaria%>%\n  filter(Metric == \"Infection Prevalence\" & Year == \"2019\")%>%\n  mutate(Prevalence = Value)%>%\n  select(c(ISO3, Prevalence))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nworld_map <- ne_countries(scale = 'medium', returnclass = \"sf\")\n\nmap_data <- world_map %>%\n  left_join(Incidence, by = c(\"iso_a3\" = \"ISO3\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = map_data, aes(fill = Prevalence)) +\n  scale_fill_gradient(low = \"white\", high = \"red\", na.value = \"gray\", name = \"Malaria Prevalence\") +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank()) +\n  labs(title = \"Malaria Prevalence by Country\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_sf(data = map_data, aes(fill = Prevalence)) +\n  scale_fill_gradient(low = \"white\", high = \"red\", na.value = \"gray\", name = \"Malaria Prevalence\") +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank()) +\n  labs(title = \"Malaria Prevalence by Country\") +\n  facet_wrap(~ region_un)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# # Filter to only include infection prevalence data for a specific year\n# Year <- 2019\n# Incidence <- Malaria %>%\n#   filter(Metric == \"Incidence Rate\" & Units == \"Cases per Thousand\" & Year == Year) %>%\n#   mutate(Incidence_Rate = Value) %>%\n#   select(c(ISO3, Incidence_Rate))\n# \n# # Get world map data with medium scale\n# world_map <- ne_countries(scale = \"medium\", returnclass = \"sf\")\n# \n# # Join incidence data with world map data\n# map_data <- world_map %>%\n#   left_join(Incidence, by = c(\"iso_a3\" = \"ISO3\"))\n# \n# # Create the choropleth map using ggplot2\n# ggplot() +\n#   geom_sf(data = map_data, aes(fill = Incidence_Rate)) +\n#   scale_fill_gradient(low = \"white\", high = \"red\", na.value = \"gray\", name = \"Malaria Incidence Rate\") +\n#   theme_minimal() +\n#   theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank()) +\n#   labs(title = paste0(\"Malaria Incidence Rate by Country in \", Year))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(readxl)\nlibrary(rnaturalearth)\nlibrary(rnaturalearthdata)\nlibrary(dplyr)\nlibrary(gganimate)\nlibrary(transformr)\n\nMalaria <- read.csv(\"National_Unit_data.csv\")\n\nIncidence <- Malaria %>%\n  filter(Metric == \"Infection Prevalence\" & Year >= 2010 & Year <= 2020) %>%\n  mutate(Year = as.factor(Year),\n         Prevalence = Value)\n\nworld_map <- ne_countries(scale = \"medium\", returnclass = \"sf\")\n\nmap_data <- world_map %>%\n  left_join(Incidence, by = c(\"iso_a3\" = \"ISO3\"))\n\np <- ggplot() +\n  geom_sf(data = map_data, aes(fill = Prevalence)) +\n  scale_fill_gradient(low = \"white\", high = \"red\", na.value = \"gray\", name = \"Malaria Prevalence\") +\n  theme_minimal() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), axis.title = element_blank()) +\n  labs(title = \"Malaria Prevalence by Country\") +\n  transition_states(Year, transition_length = 2, state_length = 2)\n\nanimate(p, fps = 25, width = 800, height = 500)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in lapply(row_vars$states, as.integer): NAs introduced by coercion\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in f(..., self = self): NAs introduced by coercion\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.gif)\n:::\n:::\n\n::: {.cell}\n\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}